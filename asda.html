<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Balanceo de Línea - PW & Takt</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="styles.css">
</head>
<body class="p-4">

  <div class="max-w-7xl mx-auto bg-white shadow-lg rounded-lg p-4 space-y-4">

    <!-- ENCABEZADO -->
    <header class="flex flex-col md:flex-row md:items-center md:justify-between gap-2 border-b pb-2">
      <div>
        <h1 class="text-xl font-bold tracking-wide text-slate-900">BALANCEO DE LÍNEA · MÉTODO PW</h1>
        <p class="text-xs text-slate-500">
          Basado en Takt Time clásico, Peso Posicional y eficiencia de balanceo.
        </p>
      </div>
      <div class="flex flex-wrap gap-2 items-center">
        <div class="flex items-center gap-1 text-xs text-slate-600">
          <span class="w-3 h-3 rounded-full bg-red-300 border border-red-500"></span> 
          <span>Tiempo &gt; Takt</span>
        </div>
        <div class="flex items-center gap-1 text-xs text-slate-600">
          <span class="w-3 h-3 rounded-full bg-emerald-200 border border-emerald-500"></span> 
          <span>80–100% Takt</span>
        </div>
        <div class="flex items-center gap-1 text-xs text-slate-600">
          <span class="w-3 h-3 rounded-full bg-slate-100 border border-slate-300"></span> 
          <span>&lt;80% Takt</span>
        </div>
      </div>
    </header>

    <!-- BLOQUE 1: PARÁMETROS GLOBALES + ESCENARIO -->
    <section class="grid md:grid-cols-3 gap-4">
      <!-- Parámetros de línea -->
      <div class="border rounded-md p-2 space-y-2">
        <div class="section-title rounded-t-md">PARÁMETROS DE LÍNEA</div>
        <div class="grid grid-cols-2 gap-2 text-xs">
          <label class="flex flex-col gap-1">
            <span>Tiempo disponible / día (min)</span>
            <input type="number" id="tiempoDisponibleMin" value="480" min="1" class="border rounded px-1 py-0.5 text-xs">
          </label>
          <label class="flex flex-col gap-1">
            <span>Demanda objetivo (pzs/día)</span>
            <input type="number" id="demandaDiaria" value="500" min="1" class="border rounded px-1 py-0.5 text-xs">
          </label>
          <label class="flex flex-col gap-1">
            <span>Fatiga global (%)</span>
            <input type="number" id="fatigaGlobal" value="15" min="0" class="border rounded px-1 py-0.5 text-xs">
          </label>
          <label class="flex flex-col gap-1">
            <span>Frecuencia por defecto (%)</span>
            <input type="number" id="frecuenciaGlobal" value="100" min="1" max="100" class="border rounded px-1 py-0.5 text-xs">
          </label>
        </div>

        <div class="mt-2 border-t pt-2 text-xs space-y-1">
          <div><span class="font-semibold">Takt time:</span> <span id="taktLabel">–</span> seg/pza</div>
          <div><span class="font-semibold">Contenido total de trabajo:</span> <span id="contenidoTotalLabel">–</span> seg/pza</div>
          <div><span class="font-semibold">N° mínimo teórico de estaciones:</span> <span id="nMinEstLabel">–</span></div>
        </div>
      </div>

      <!-- Escenario / guardar -->
      <div class="border rounded-md p-2 space-y-2">
        <div class="section-title rounded-t-md">ESCENARIO / VERSIONADO</div>
        <div class="grid grid-cols-1 gap-2 text-xs">
          <label class="flex flex-col gap-1">
            <span>Nombre de escenario</span>
            <input type="text" id="scenarioName" placeholder="Ej: HILUX_OP10_Muro10" class="border rounded px-1 py-0.5 text-xs">
          </label>
          <label class="flex flex-col gap-1">
            <span>Nota / contexto</span>
            <textarea id="scenarioNote" rows="3" class="border rounded px-1 py-0.5 text-xs" placeholder="Ej: Balanceo A con muro 10% y retrabajo 5%"></textarea>
          </label>
        </div>
        <div class="flex flex-wrap gap-2 mt-1 text-xs">
          <button id="btnSave" class="btn">Guardar</button>
          <button id="btnLoad" class="btn">Cargar</button>
          <button id="btnClear" class="btn">Limpiar</button>
        </div>
        <p class="text-[0.7rem] text-slate-500 mt-1">
          Se guarda localmente en este navegador (localStorage). Escribí el mismo nombre para cargarlo.
        </p>
      </div>

      <!-- Resumen / capacidad / diagnóstico -->
      <div class="border rounded-md p-2 space-y-1 text-xs">
        <div class="section-title rounded-t-md">RESUMEN DE BALANCEO</div>
        <div class="grid grid-cols-2 gap-x-2 gap-y-1">
          <div class="font-semibold">N° estaciones reales (PW):</div>
          <div id="nEstRealesLabel">–</div>

          <div class="font-semibold">% Eficiencia de balanceo:</div>
          <div id="eficienciaLabel">–</div>

          <div class="font-semibold">Tiempo ocioso total:</div>
          <div id="tiempoOciosoLabel">–</div>

          <div class="font-semibold">Capacidad real (pzs/h):</div>
          <div id="capacidadHoraLabel">–</div>

          <div class="font-semibold">Capacidad real (pzs/día):</div>
          <div id="capacidadDiaLabel">–</div>
        </div>

        <div class="mt-2 text-[0.7rem]">
          <span class="font-semibold">Diagnóstico:</span>
          <span id="diagnosticoLabel" class="text-slate-700">Cargá datos y presioná "Recalcular".</span>
        </div>

        <div class="mt-2">
          <button id="btnRecalcular" class="btn w-full">
            Recalcular PW, estaciones y gráficos
          </button>
        </div>
      </div>
    </section>

    <!-- BLOQUE 2: TABLA DE OPERACIONES -->
    <section>
      <div class="section-title rounded-t-md">OPERACIONES / TAREAS BASE (INPUT PARA PW)</div>
      <div class="overflow-x-auto">
        <table class="w-full">
          <thead>
            <tr>
              <th class="header-cell">#</th>
              <th class="header-cell">Código OP</th>
              <th class="header-cell">Descripción</th>
              <th class="header-cell">
                T. observado<br>(seg/ciclo)
                <span title="Tiempo crudo medido de la actividad para un ciclo completo, sin dividir por Multi.">
                  ⓘ
                </span>
              </th>
              <th class="header-cell">
                Multi<br>(pzs/ciclo)
                <span title="Cuántas piezas salen simultáneamente en ese ciclo. Ej: molde 2 cavidades → 2.">
                  ⓘ
                </span>
              </th>
              <th class="header-cell">
                Fatiga op. (%)<br>(vacío = global)
                <span title="Porcentaje adicional aplicado al tiempo observado de esta operación. Si lo dejás vacío, se usa la fatiga global.">
                  ⓘ
                </span>
              </th>
              <th class="header-cell">
                Frecuencia (%)<br>en piezas
                <span title="Si la tarea se hace solo en parte de las piezas (ej: inspección 10%), poné ese porcentaje. Se pondera el tiempo estándar.">
                  ⓘ
                </span>
              </th>
              <th class="header-cell">
                Predecesoras<br>(OP10,OP20)
              </th>
              <th class="header-cell">
                T. estándar<br>(seg/pza)
              </th>
              <th class="header-cell">
                Peso Posicional<br>(PW)
              </th>
              <th class="header-cell">
                Estación PW<br>asignada
              </th>
              <th class="header-cell">Acciones</th>
            </tr>
          </thead>
          <tbody id="tasksBody">
            <!-- Filas dinámicas -->
          </tbody>
        </table>
      </div>
      <div class="flex justify-between mt-2 text-xs">
        <button id="btnAddRow" class="btn">
          + Agregar operación
        </button>
        <p class="text-[0.7rem] text-slate-500">
          Tip: cargá primero todos los tiempos observados, Multi y fatigas; luego las precedencias.
        </p>
      </div>
    </section>

    <!-- BLOQUE 3: GRÁFICOS -->
    <section class="grid md:grid-cols-2 gap-4">
      <div class="border rounded-md p-2">
        <div class="section-title rounded-t-md">CARGA POR ESTACIÓN VS TAKT</div>
        <div class="h-64">
          <canvas id="chartStations"></canvas>
        </div>
      </div>
      <div class="border rounded-md p-2">
        <div class="section-title rounded-t-md">TIEMPO POR OPERACIÓN VS TAKT</div>
        <div class="h-64">
          <canvas id="chartOps"></canvas>
        </div>
      </div>
    </section>

    <!-- BLOQUE 4: PANEL DE ERRORES / ADVERTENCIAS -->
    <section>
      <div class="section-title rounded-t-md">MENSAJES DE VALIDACIÓN</div>
      <div id="errorPanel" class="error-panel text-xs p-2 bg-slate-50 border border-slate-200 rounded-b-md text-slate-800">
        Sin errores por el momento.
      </div>
    </section>
  </div>

</body>
  <script src="app.js"></script>
</body>
</html>
